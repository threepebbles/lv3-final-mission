
# 서비스 인프라 및 아키텍처 설명

## 1. 인프라 개요
제가 설계하고 구축한 서비스는 Spring Boot 기반 웹 애플리케이션을 AWS 인프라 위에 안정적이고 확장 가능하게 운영하는 구조입니다.    
목표는 **개발 환경과 운영 환경의 일관성**을 확보하고, 실제 서비스 운영에서 발생할 수 있는 장애나 보안 문제에 대응할 수 있는 기반을 마련하는 것입니다.
  
---  
## 2. 네트워크 및 인프라 리소스 구성

### VPC
- VPC: `TECHCOURSE-PROJECT (10.0.0.0/16)`
- public subnet: `project-public-a (10.0.0.0/24)`
  - 외부에서 접근 가능한 EC2 (dev, prod) 배치
  - EC2를 private subnet에 배치시키고, 앞단에 public ALB + ASG 사용하면 장애 복구와 스케일링(트래픽에 따른 인스턴스 증감)에 더 유연한 구조가 될 수 있습니다. 하지만, 서비스의 규모와 미션 시간을 고려했을 때 욕심이 과한 설계 같아서 제외했습니다.
- private subnet: `10.0.100.0/24`, `10.0.101.0/24`, `10.0.102.0/24`, `10.0.103.0/24`
  - VPC 외부의 RDS 접근을 제한하기 위해 private subnet group을 사용했습니다.
  - RDS의 가용성을 위해 각각 다른 AZ에 위치한 subnet group을 사용했습니다.

---  

### EC2
- **heiler-lv3-final-dev**: 개발 서버
- **heiler-lv3-final-prod**: 운영 서버
- 두 EC2 모두 public subnet에 위치해있습니다.

dev/prod 모두 스프링 앱은 **Docker** 이미지로 패키징하여 사용했습니다.
- 스프링 앱 실행 환경을 표준화하여, 설정 누락이나 환경 불일치 문제를 예방했습니다.
- Docker 컨테이너 별 격리된 프로세스 실행 환경 제공합니다.
- GitHub Container Registry에 스프링 앱 이미지를 저장하고, 동일한 이미지를 amd64/arm64 플랫폼 위에서 실행 가능하도록 했습니다.

dev/prod 모두 리버스 프록시의 역할로 **Nginx**를 사용했습니다.
- 보안 강화를 위해 모든 HTTP 요청(암호화되지 않은 트래픽)을 HTTPS로 리다이렉트했습니다.
- Let’s Encrypt로 발급받은 인증서로 TLS 암호화를 수행했습니다.
- 외부에서 Nginx를 거치지 않고 직접 스프링 앱에 접근하는 것을 막았습니다.

**dev 환경**은 실험/테스트 환경이므로 **비용이 적게 들고, 자유도가 높도록 구성**했습니다.
- 즉각적인 디버깅, MySQL cli 사용을 쉽게 하기 위해 하나의 EC2 내에 스프링 앱과 **DB를 Docker 컨테이너로** 함께 실행했습니다.
- 또한, dev 환경에서 생성되는 데이터는 스냅샷/롤백/장애 대응과 같은 고가용성을 위한 기능이 필요 없으므로 RDS 대신 컨테이너를 사용했습니다.

**prod 환경**은 실제 서비스 환경이므로 장애 대응에 유리한 환경을 구성했습니다.
- 스냅샷/롤백 기능/AZ 문제 발생 시 장애 대응 등 가용성이 높은 기능을 제공해주는 **RDS를 사용**했습니다.

---  

### RDS (데이터베이스)
- 스냅샷, 장애 복구 기능을 제공해줍니다.
- 가용성을 위해 각각 다른 AZ에 위치한 4개의 private subnet이 묶여있는 subnet group을 사용했습니다.
- DB 접근은 EC2만 허용하여 외부 접근 경로를 최소화했습니다.

---

## 3. CI/CD 파이프라인

### GitHub Actions

소스 변경 시 자동 빌드·배포가 수행되도록 CI/CD 파이프라인을 구성했습니다.
develop/main 브랜치에 변경이 발생하면 워크플로우가 트리거되어 자동으로 동작합니다.

- 스프링 앱 빌드에 성공하면, Docker 이미지로 패키징하여 GitHub Container Registry에 저장합니다.
- GitHub Container Registry에 저장되는 Docker 이미지는 push된 순서대로 버저닝되고 있습니다. (ex. `prod-1`, `prod-2`, `prod-3`) 이미지 버저닝은 롤백을 용이하게 하기 위함입니다.
- private submodule을 이용해서 API 키, DB 계정 정보 등 민감한 secret을 관리합니다.
- GitHub Actions의 self-hosted runner를 사용하여, EC2 환경에 자동 배포 및 애플리케이션 실행을 수행합니다.
